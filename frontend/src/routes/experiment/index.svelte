<script lang="ts">
	import { browser, dev } from "$app/env";
	import { fade } from "svelte/transition";
	import FormField from "@smui/form-field";
	import Checkbox from "@smui/checkbox";
	import Button, { Label } from "@smui/button";
	import { goto } from "$app/navigation";
	import { state, expId } from "../../stores";
	import { socket } from "../../socket";
	import { v4 as uuidv4 } from "uuid";
	import { v4 } from "@lukeed/uuid";

	let checked: boolean | null = null;
	let uuid = "";

	function join() {
		uuid = uuidv4();
		$expId = uuid;
		socket.emit("experiment-create", uuid);
	}

	socket.on("before-experiment-join", function (game) {
		$state = game;
		goto("/experiment/operative");
	});
</script>

<svelte:head>
	<title>Experiment</title>
</svelte:head>

<div class="content" in:fade>
	<h1>Experiment</h1>
	<section>
		<small
			>This experiment is be split into two parts, so depending on which group you get assigned to,
			you will have one of the following experiments.</small
		>

		<h3>Part 1: Assessing The AI</h3>
		<small>In this part of the experiment is in two phases</small>
		<h4>Phase 1</h4>
		<p>
			In this part of the experiment you will be presented with a grid of words. A clue will appear
			on the screen that links 2 of the words on the board together. For example, if the words <i
				>apple</i
			>
			and <i>banana</i> were in the grid, a possible clue might be <i>fruit</i>. There may be more
			than 2 words that you think the clue might relate to, but that is no problem. There will be 4
			input boxes where you must enter the words you think that the clue is related to. The first
			two inputs are <b>required</b>, but the final two inputs are optional. Enter the words you
			think mostly relate to the clue in the first 2 inputs, and any additional words (if
			applicable) in the last two inputs.
		</p>
		<p>
			Over the course of this phase of the experiment there will be 4 clues. It may take a little
			bit of time for the AI to generate the clue, so while this is happening you will see a loading
			symbol. When the clue has been generated, the loading symbol will be replaced with the clue.
			As the experiment requires 2 words, the submit button will only become visible when the first
			two inputs have been filled. Once you have submitted your answers for the final clue, phase 2
			of the experiment will begin.
		</p>
	</section>
	<section>
		<h4>Phase 2</h4>
		<p>
			In this part, you will be presented with a another grid of words. This time however, there
			will be a colour associated to each word. This time, instead of being presented with a clue,
			you will be presented with two words, and the goal is to try think of a single-word clue that
			that will link the two words.
		</p>
		<p>
			A very important consideration to note (and this is what makes Codenames so fun) is that the
			goal is to make sure your clue relates to your team's words, and not to the other team's
			words. In this part of the experiment, you will be playing on the <strong>blue</strong> team. The
			two words will be blue words, so make sure your clue could not be mistaken for a clue relating
			to the red team. There will also be yellow words and a purple word, your clue should not be mistaken
			as a clue for these colours either. If you cannot think of a word that links both words, try think
			of a word that relates to one of the words.
		</p>
		<p />
	</section>
	<section>
		<h3>Part 2: Comparing Clues</h3>
		<p>
			In this part of the experiment, you will be presented a grid of words and their associated
			colours, and you will be presented with two words and two clues. Both clues are both related
			to the the two presented words, but one was generated by the AI and the other was generated
			and you must choose which clue you think is the better clue, taking into account how the clue
			relates to the two words, and how it relates to the board.
		</p>
	</section>
	<FormField>
		<!--
          Note: binding to `indeterminate` is probably a bad idea.
          The component will set `indeterminate`, but it should be
          always related to `checked`.
       
          `indeterminate` is required for the correct state, even
          if `checked` is null.
        -->
		<Checkbox bind:checked indeterminate={checked === null} input$required />
		<span slot="label"
			>I have read the description of how this experiment will work and understand what I must do</span
		>
	</FormField>
	{#if checked === true}
		<div class="submit">
			<br />
			<Button variant="raised" on:click={join}>
				<Label>Start experiment</Label>
			</Button>
		</div>
	{/if}
</div>

<style>
	.content {
		width: 50%;
		max-width: var(--column-width);
		margin: var(--column-margin-top) auto 0 auto;
	}

	.submit {
		text-align: center;
	}
</style>
